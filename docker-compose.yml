# Runs a collection of test scenarios.
#
# Assumes that the test data has already been arranged!

version: "3.9"

services:

  # Maps the working directory to the default workspace.
  # Builds to "public".
  root:
    image: cariad/hugo-ci:${BRANCH}
    volumes:
      - .:/workspace

  # Maps the "alt-workspace" directory to the "/alt-workspace" workspace.
  # Builds to "alt-workspace/public".
  alt-workspace:
    command: >-
      --workspace /alt-workspace
    image: cariad/hugo-ci:${BRANCH}
    volumes:
      - ./alt-workspace:/alt-workspace

  # subdirectory:
  #   image: cariad/hugo-ci:${BRANCH}
  #   volumes:
  #     - ./subdirectory:/src
  #     - ./subdirectory/public:/pub

  # upload:
  #   command: >-
  #     --s3-bucket ${S3_BUCKET}
  #     --s3-region ${AWS_DEFAULT_REGION}

  #   image: cariad/hugo-ci:${BRANCH}
  #   environment:
  #     - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
  #     - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
  #   volumes:
  #     - .:/src
  #     - ./public-uploaded:/pub

  # upload_with_prefix:
  #   command: >-
  #     --s3-bucket ${S3_BUCKET}
  #     --s3-prefix ${GITHUB_SHA}

  #   image: cariad/hugo-ci:${BRANCH}
  #   environment:
  #     - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
  #     - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
  #   volumes:
  #     - .:/src
  #     - ./public-uploaded-with-prefix:/pub
